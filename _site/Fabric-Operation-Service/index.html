<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>Fabric: The Operation Service &#8211; Maple Story</title> <meta name="description" content="Stick to note down what I’v learnt"> <meta name="keywords" content="Hyperledger Fabric"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="halve.png"> <meta name="twitter:title" content="Fabric: The Operation Service"> <meta name="twitter:description" content="Stick to note down what I’v learnt"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Fabric: The Operation Service"> <meta property="og:description" content="Stick to note down what I’v learnt"> <meta property="og:url" content="http://localhost:4000/Fabric-Operation-Service/"> <meta property="og:site_name" content="Maple Story"> <meta property="og:image" content="http://localhost:4000/images/halve.png"> <link rel="canonical" href="http://localhost:4000/Fabric-Operation-Service/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/unsplash-gallery-image-3.jpg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/unsplash-image-10.jpg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(http://localhost:4000/images/home.jpg) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="http://localhost:4000" class="logo"><img src="http://localhost:4000/images/halve.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">Fabric: The Operation Service </h1> <ul class="tags"> <li><a href="http://localhost:4000/tags#Hyperledger Fabric">Hyperledger Fabric</a></li> </ul> <div class="section-line reverse"><a href="http://localhost:4000/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <a href="../posts.html" title="posts" class="posts-menu-icon"></a> <a title="projects" class="projects-menu-icon"> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">19 May 2020</div> <center><h2><b>The Operation Service</b></h2></center> <p><br /></p> <p><strong>总结：</strong></p> <blockquote> <p>该API与Fabric网络服务无关, 但由Fabric提供HTTP服务、RESTful API。</p> <p>yaml文件中设置参数，通过http://listenAddress:port/healthz 进行某个节点的健康状态检查</p> <p>yaml文件中设置参数，通过URL:PORT进行<strong>日志管理层级查看，设置，能管理细分的层级。</strong>（如何查看细分的层级，<em>有待实验</em>）</p> <p>TLS控制设置是否是独立，<em>有待实验</em>。</p> </blockquote> <p>The peer and the orderer host an HTTP server that offers a RESTful “operations” API. This API is unrelated to the Fabric network services and is intended to be used by operators, not administrators or “users” of the network.</p> <p>peer对等节点和排序节点托管一个HTTP服务器，该服务器提供RESTful API。该API与Fabric网络服务无关，旨在供网络的运营商而非网络管理员或“用户”使用。</p> <p>The API exposes the following capabilities:</p> <p>API提供了如下功能：</p> <ul> <li> <p>Log level management</p> <p>日志级别管理</p> </li> <li> <p><strong>Health</strong> checks</p> <p>网络运行情况检查【翻译有待商榷】</p> </li> <li> <p>Prometheus target for operational metrics (when configured)</p> <p>操作指标的普罗米修斯（配置时）【X】</p> </li> </ul> <h2 id="configuring-the-operations-service">Configuring the Operations Service</h2> <h2 id="配置运营服务">配置运营服务</h2> <p>The operations service requires two basic pieces of configuration:</p> <p>运营服务需要两个基本的配置：</p> <ul> <li> <p>The <strong>address</strong> and <strong>port</strong> to listen on.</p> <p>监听的地址和端口</p> </li> <li> <p>The <strong>TLS certificates</strong> and <strong>keys</strong> to use for authentication and encryption. Note, <strong>these certificates should be generated by a separate and dedicated CA</strong>. Do not use a CA that has generated certificates for any organizations in any channels.</p> <p>TLS证书和私钥被用于身份认证和加密。提示，这些证书应该由分开的、专门的CA来生成。该CA机构能为任一通道的所有的组织生成证书。</p> </li> </ul> <h3 id="peer">Peer</h3> <p>For each peer, the operations server can be configured in the <code class="language-plaintext highlighter-rouge">operations</code> section of <code class="language-plaintext highlighter-rouge">core.yaml</code>:</p> <p>对于每一个peer节点，可以在<code class="language-plaintext highlighter-rouge">core.yaml</code>文件的<code class="language-plaintext highlighter-rouge">operations</code>部分进行配置运营服务：</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">operations</span><span class="pi">:</span>
  <span class="c1"># host and port for the operations server</span>
  <span class="na">listenAddress</span><span class="pi">:</span> <span class="s">127.0.0.1:9443</span>

  <span class="c1"># TLS configuration for the operations endpoint</span>
  <span class="na">tls</span><span class="pi">:</span>
    <span class="c1"># TLS enabled</span>
    <span class="na">enabled</span><span class="pi">:</span> <span class="no">true</span>

    <span class="c1"># path to PEM encoded server certificate for the operations server</span>
    <span class="na">cert</span><span class="pi">:</span>
      <span class="na">file</span><span class="pi">:</span> <span class="s">tls/server.crt</span>

    <span class="c1"># path to PEM encoded server key for the operations server</span>
    <span class="na">key</span><span class="pi">:</span>
      <span class="na">file</span><span class="pi">:</span> <span class="s">tls/server.key</span>

    <span class="c1"># most operations service endpoints require client authentication when TLS</span>
    <span class="c1"># is enabled. clientAuthRequired requires client certificate authentication</span>
    <span class="c1"># at the TLS layer to access all resources.</span>
    <span class="na">clientAuthRequired</span><span class="pi">:</span> <span class="no">false</span>

    <span class="c1"># paths to PEM encoded ca certificates to trust for client authentication</span>
    <span class="na">clientRootCAs</span><span class="pi">:</span>
      <span class="na">files</span><span class="pi">:</span> <span class="pi">[]</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">listenAddress</code> key defines the host and port that the operation server will listen on. If the server should listen on all addresses, the host portion can be omitted.</p> <p><code class="language-plaintext highlighter-rouge">listenAddress</code>配置定义了运营服务将要监听的主机和端口。如果服务需要监听所有地址，则主机部分可以省略。</p> <p>The <code class="language-plaintext highlighter-rouge">tls</code> section is used to indicate whether or not TLS is enabled for the operations service, the location of the service’s certificate and private key, and the locations of certificate authority root certificates that should be trusted for client authentication. When <code class="language-plaintext highlighter-rouge">enabled</code> is true, most of the operations service endpoints require client authentication, therefore <code class="language-plaintext highlighter-rouge">clientRootCAs.files</code> must be set. When <code class="language-plaintext highlighter-rouge">clientAuthRequired</code> is <code class="language-plaintext highlighter-rouge">true</code>, the TLS layer will require clients to provide a certificate for authentication on every request. See Operations Security section below for more details.</p> <p><code class="language-plaintext highlighter-rouge">tls</code>配置用来表示运营服务是否启用TLS，服务的证书和私钥的存放位置，能被客户端信任的CA根证书所在的位置。当<code class="language-plaintext highlighter-rouge">enable</code>为true的时候，大多数的运营服务端需要客户端认证，因此<code class="language-plaintext highlighter-rouge">clientRootCAs.files</code>属性必须配置。当<code class="language-plaintext highlighter-rouge">clientAuthRequired</code>为true的时候，TLS层需要客户端提供证书，用于每次请求的时候进行认证。通过Operations Security章节了解更多细节。</p> <h3 id="orderer">Orderer</h3> <p>For each orderer, the operations server can be configured in the Operations section of <code class="language-plaintext highlighter-rouge">orderer.yaml</code>:</p> <p>对每个orderer节点，运营服务能够在orderer.yaml文件中的Operations部分进行配置。</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">Operations</span><span class="pi">:</span>
  <span class="c1"># host and port for the operations server</span>
  <span class="na">ListenAddress</span><span class="pi">:</span> <span class="s">127.0.0.1:8443</span>

  <span class="c1"># TLS configuration for the operations endpoint</span>
  <span class="na">TLS</span><span class="pi">:</span>
    <span class="c1"># TLS enabled</span>
    <span class="na">Enabled</span><span class="pi">:</span> <span class="no">true</span>

    <span class="c1"># PrivateKey: PEM-encoded tls key for the operations endpoint</span>
    <span class="na">PrivateKey</span><span class="pi">:</span> <span class="s">tls/server.key</span>

    <span class="c1"># Certificate governs the file location of the server TLS certificate.</span>
    <span class="na">Certificate</span><span class="pi">:</span> <span class="s">tls/server.crt</span>

    <span class="c1"># Paths to PEM encoded ca certificates to trust for client authentication</span>
    <span class="na">ClientRootCAs</span><span class="pi">:</span> <span class="pi">[]</span>

    <span class="c1"># Most operations service endpoints require client authentication when TLS</span>
    <span class="c1"># is enabled. ClientAuthRequired requires client certificate authentication</span>
    <span class="c1"># at the TLS layer to access all resources.</span>
    <span class="na">ClientAuthRequired</span><span class="pi">:</span> <span class="no">false</span>
</code></pre></div></div> <p>The <code class="language-plaintext highlighter-rouge">ListenAddress</code> key defines the host and port that the operations server will listen on. If the server should listen on all addresses, the host portion can be omitted.</p> <p><code class="language-plaintext highlighter-rouge">listenAddress</code>配置定义了运营服务将要监听的主机和端口。如果服务需要监听所有地址，则主机部分可以省略。</p> <p>The <code class="language-plaintext highlighter-rouge">TLS</code> section is used to indicate whether or not TLS is enabled for the operations service, the location of the service’s certificate and private key, and the locations of certificate authority root certificates that should be trusted for client authentication. When <code class="language-plaintext highlighter-rouge">Enabled</code> is true, most of the operations service endpoints require client authentication, therefore <code class="language-plaintext highlighter-rouge">RootCAs</code> must be set. When <code class="language-plaintext highlighter-rouge">ClientAuthRequired</code> is <code class="language-plaintext highlighter-rouge">true</code>, the TLS layer will require clients to provide a certificate for authentication on every request. See Operations Security section below for more details.</p> <p><code class="language-plaintext highlighter-rouge">tls</code>配置用来表示运营服务是否启用TLS，服务的证书和私钥的存放位置，能被客户端信任的CA根证书所在的位置。当<code class="language-plaintext highlighter-rouge">enable</code>为true的时候，大多数的运营服务端需要客户端认证，因此<code class="language-plaintext highlighter-rouge">RootCAs</code>属性必须配置。当<code class="language-plaintext highlighter-rouge">clientAuthRequired</code>为true的时候，TLS层需要客户端提供证书，用于每次请求的时候进行认证。通过Operations Security章节了解更多细节。</p> <h3 id="operations-security">Operations Security</h3> <p>As the operations service is focused on operations and intentionally unrelated to the Fabric network, it does not use the Membership Services Provider for access control. Instead, the operations service relies entirely on mutual TLS with client certificate authentication.</p> <p>由于运营服务关注与其运营情况并且有意识的不与Fabric网络相关，因此，不要用Membership Services Provider来访问控制。相反，运营服务完全依赖于同证书认证客户端之间的TLS。</p> <p>When TLS is disabled, authorization is bypassed and any client that can connect to the operations endpoint will be able to use the API.</p> <p>当TLS被禁用，认证工作将被撇开不管，任何能连接到运营服务端的客户端都能够对其使用API访问。</p> <p>When TLS is enabled, a valid client certificate must be provided in order to access all resources unless explicitly noted otherwise below.</p> <p>当启用TLS时，必须提供有效的客户端证书来访问所有资源，除非下面另有明确说明。</p> <p>When clientAuthRequired is also enabled, the TLS layer will require a valid client certificate regardless of the resource being accessed.</p> <p>当<code class="language-plaintext highlighter-rouge">clientAuthRequired </code>也被启用时，TLS层也需要有效的客户端证书，不管资源会不会被访问。</p> <h3 id="log-level-management">Log Level Management</h3> <p>The operations service provides a <code class="language-plaintext highlighter-rouge">/logspec</code> resource that operators can use to manage the active logging spec for a peer or orderer. The resource is a conventional REST resource and supports <code class="language-plaintext highlighter-rouge">GET</code> and <code class="language-plaintext highlighter-rouge">PUT</code> requests.</p> <p>运营服务提供一个<code class="language-plaintext highlighter-rouge">/logspec</code>选项让操作者能管理peer节点或orderer节点活跃的日志配置。</p> <p>When a <code class="language-plaintext highlighter-rouge">GET /logspec</code> request is received by the operations service, it will respond with a JSON payload that contains the current logging specification:</p> <p>当运营服务接收到<code class="language-plaintext highlighter-rouge">GET /logspec</code>请求时，他会回应一个包含当前日志的类型的JSON数据。</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"spec"</span><span class="p">:</span><span class="s2">"info"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>When a <code class="language-plaintext highlighter-rouge">PUT /logspec</code> request is received by the operations service, it will read the body as a JSON payload. The payload must consist of a single attribute named <code class="language-plaintext highlighter-rouge">spec</code>.</p> <p>当运营服务接收到<code class="language-plaintext highlighter-rouge">GET /logspec</code>请时，他将读取一个JSON数据，该数据中必须包含一个属性<code class="language-plaintext highlighter-rouge">spec</code>。</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"spec"</span><span class="p">:</span><span class="s2">"chaincode=debug:info"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>If the spec is activated successfully, the service will respond with a <code class="language-plaintext highlighter-rouge">204 "No Content"</code> response. If an error occurs, the service will respond with a <code class="language-plaintext highlighter-rouge">400 "Bad Request"</code> and an error payload:</p> <p>如果spec被成功激活，服务端将会回一条<code class="language-plaintext highlighter-rouge">204 "No Content"</code>响应。如果发生了错误，服务端将会回应<code class="language-plaintext highlighter-rouge">400 "Bad Request"</code> 并且有一条JSON的payload如下所示。</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="nl">"error"</span><span class="p">:</span><span class="s2">"error message"</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <h2 id="health-checks"><strong>Health</strong> Checks</h2> <p>The operations service provides a <code class="language-plaintext highlighter-rouge">/healthz</code> resource that operators can use to help determine the liveness and <strong>health</strong> of peers and orderers. The resource is a conventional REST resource that supports GET requests. The implementation is intended to be compatible with the liveness probe model used by Kubernetes but can be used in other contexts.</p> <p>排序服务提供一个 <code class="language-plaintext highlighter-rouge">/healthz</code>配置，来使运营商能使用它来查明peer节点和orderer节点的活跃度或健康状态。</p> <p>When a <code class="language-plaintext highlighter-rouge">GET /healthz</code> request is received, the operations service will call all registered <strong>health</strong> checkers for the process. When all of the <strong>health</strong> checkers return successfully, the operations service will respond with a <code class="language-plaintext highlighter-rouge">200 "OK"</code> and a JSON body:</p> <p>当接收到一条<code class="language-plaintext highlighter-rouge">GET /healthz</code>请求时，运营服务将会调用进程中所有注册过的健康检查器。当所有检查器都返回成功时，运营服务将会返回一条<code class="language-plaintext highlighter-rouge">200 "OK"</code>, 并且JSON中包含如下数据：</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"OK"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2009-11-10T23:00:00Z"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>If one or more of the <strong>health</strong> checkers returns an error, the operations service will respond with a <code class="language-plaintext highlighter-rouge">503 "Service Unavailable"</code> and a JSON body that includes information about which health checker failed:</p> <p>入股一条或多条健康检查器返回错误，运营服务将返回一条<code class="language-plaintext highlighter-rouge">503 "Service Unavailable" </code>并且JSON中包含如下关于哪一个健康检查器失败的信息。</p> <div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"status"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Service Unavailable"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"time"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2009-11-10T23:00:00Z"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"failed_checks"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
    </span><span class="p">{</span><span class="w">
      </span><span class="nl">"component"</span><span class="p">:</span><span class="w"> </span><span class="s2">"docker"</span><span class="p">,</span><span class="w">
      </span><span class="nl">"reason"</span><span class="p">:</span><span class="w"> </span><span class="s2">"failed to connect to Docker daemon: invalid endpoint"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div> <p>In the current version, the only <strong>health</strong> check that is registered is for Docker. Future versions will be enhanced to add additional health checks.</p> <p>在当前版本（2020/5/11的latest）中，只有为Docker注册的一条健康检查，在将来的版本将会增加额外的健康检查。</p> <p>When TLS is enabled, a valid client certificate is not required to use this service unless <code class="language-plaintext highlighter-rouge">clientAuthRequired</code> is set to <code class="language-plaintext highlighter-rouge">true</code>.</p> <p>当TLS被启用时，不需要一个有效的客户端证书来使用这项服务，除非<code class="language-plaintext highlighter-rouge">clientAuthRequired</code>被设置为<code class="language-plaintext highlighter-rouge">true</code>。</p> <h2 id="metrics">Metrics</h2> <p>//度量</p> <p>Some components of the Fabric peer and orderer expose metrics that can help provide insight into the behavior of the system. Operators and administrators can use this information to better understand how the system is performing over time.</p> <p>一些Fabric peer和orderer组件会暴露出一些指标，这些指标将有助于提供对系统内部的行为的观察、了解。</p> <h3 id="configuring-metrics">Configuring Metrics</h3> <p>配置指标</p> <p>Fabric provides two ways to expose metrics: a <strong>pull</strong> model based on Prometheus and a <strong>push</strong> model based on StatsD.</p> <p>Fabric提供两种方式来暴露这些指标: 一种是基于Prometheus的<strong>pull</strong>模型、一种是基于StatsD的<strong>push</strong>模型。</p> <h3 id="prometheus">Prometheus</h3> <p>A typical Prometheus deployment scrapes metrics by requesting them from an HTTP endpoint exposed by instrumented targets. As Prometheus is responsible for requesting the metrics, it is considered a pull system.</p> <p>一种典型的Prometheus部署方式，通过请求测试目标暴露的HTTP端点来抓取这些指标数据。</p> <p>When configured, a Fabric peer or orderer will present a <code class="language-plaintext highlighter-rouge">/metrics</code> resource on the operations service.</p> <p>当配置完成，一个Fabric的peer或者orderer将会在运营服务中呈现一个<code class="language-plaintext highlighter-rouge">/metrics</code>资源。</p> <h4 id="peer-1">Peer</h4> <p>A peer can be configured to expose a <code class="language-plaintext highlighter-rouge">/metrics</code> endpoint for Prometheus to scrape by setting the metrics provider to <code class="language-plaintext highlighter-rouge">prometheus</code> in the <code class="language-plaintext highlighter-rouge">metrics</code> section of <code class="language-plaintext highlighter-rouge">core.yaml</code>.</p> <p>一个peer可以配置<code class="language-plaintext highlighter-rouge">/metrics</code>终端用于Prometheus抓取信息。在<code class="language-plaintext highlighter-rouge">core.yaml</code>文件中的<code class="language-plaintext highlighter-rouge">metrics</code>部分设置<code class="language-plaintext highlighter-rouge">provider</code>为<code class="language-plaintext highlighter-rouge">prometheus</code>。</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">metrics</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">prometheus</span>
</code></pre></div></div> <h4 id="orderer-1">Orderer</h4> <p>An orderer can be configured to expose a <code class="language-plaintext highlighter-rouge">/metrics</code> endpoint for Prometheus to scrape by setting the metrics provider to <code class="language-plaintext highlighter-rouge">prometheus</code> in the <code class="language-plaintext highlighter-rouge">Metrics</code> section of <code class="language-plaintext highlighter-rouge">orderer.yaml</code>.</p> <p>一个peer可以配置<code class="language-plaintext highlighter-rouge">/metrics</code>终端用于Prometheus抓取信息。在<code class="language-plaintext highlighter-rouge">orderer.yaml</code>文件中的<code class="language-plaintext highlighter-rouge">Metrics</code>部分设置<code class="language-plaintext highlighter-rouge">Provider</code>为<code class="language-plaintext highlighter-rouge">prometheus</code>。</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">Metrics</span><span class="pi">:</span>
  <span class="na">Provider</span><span class="pi">:</span> <span class="s">prometheus</span>
</code></pre></div></div> <h3 id="statsd">StatsD</h3> <p>StatsD is a simple statistics aggregation daemon. Metrics are sent to a <code class="language-plaintext highlighter-rouge">statsd</code> daemon where they are collected, aggregated, and pushed to a backend for visualization and alerting. As this model requires instrumented processes to send metrics data to StatsD, this is considered a push system.</p> <p>StatsD 是一种简单的统计聚合的守护进程。指标将被发送到一个<code class="language-plaintext highlighter-rouge">statsd</code>进程中，在这里他们将被收集，统计，推送到一个可视化和监视报警的后端。因为这个模型需要被测试进程发送数据到StatsD，因此被认为是一个推送系统。</p> <h4 id="peer-2">Peer</h4> <p>A peer can be configured to send metrics to StatsD by setting the metrics provider to <code class="language-plaintext highlighter-rouge">statsd</code> in the <code class="language-plaintext highlighter-rouge">metrics</code> section of <code class="language-plaintext highlighter-rouge">core.yaml</code>. The <code class="language-plaintext highlighter-rouge">statsd</code> subsection must also be configured with the address of the StatsD daemon, the network type to use (<code class="language-plaintext highlighter-rouge">tcp</code> or <code class="language-plaintext highlighter-rouge">udp</code>), and how often to send the metrics. An optional <code class="language-plaintext highlighter-rouge">prefix</code> may be specified to help differentiate the source of the metrics — for example, differentiating metrics coming from separate peers — that would be prepended to all generated metrics.</p> <p>通过在<code class="language-plaintext highlighter-rouge">core.yaml</code>的<code class="language-plaintext highlighter-rouge">metrics</code>部分设置<code class="language-plaintext highlighter-rouge">metrics</code>的<code class="language-plaintext highlighter-rouge">provider</code>为<code class="language-plaintext highlighter-rouge">statsd</code>，peer就能够被配置成发送<code class="language-plaintext highlighter-rouge">metrics</code>到StatsD。<code class="language-plaintext highlighter-rouge">statsd</code>的子章节也同样需要配置，StatsD进程的地址（ip+端口），网络类型（TCP 或 UDP），发送metrics的频率。一个可选的<code class="language-plaintext highlighter-rouge">prefix</code>或许可以被用作区分不同资源的指标，<em>例如区分不同指标来自不同的peer节点，这将预备生成所有的指标。</em></p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">metrics</span><span class="pi">:</span>
  <span class="na">provider</span><span class="pi">:</span> <span class="s">statsd</span>
  <span class="na">statsd</span><span class="pi">:</span>
    <span class="na">network</span><span class="pi">:</span> <span class="s">udp</span>
    <span class="na">address</span><span class="pi">:</span> <span class="s">127.0.0.1:8125</span>
    <span class="na">writeInterval</span><span class="pi">:</span> <span class="s">10s</span>
    <span class="na">prefix</span><span class="pi">:</span> <span class="s">peer-0</span>
</code></pre></div></div> <h4 id="orderer-2">Orderer</h4> <p>An orderer can be configured to send metrics to StatsD by setting the metrics provider to <code class="language-plaintext highlighter-rouge">statsd</code> in the <code class="language-plaintext highlighter-rouge">Metrics</code> section of <code class="language-plaintext highlighter-rouge">orderer.yaml</code>. The <code class="language-plaintext highlighter-rouge">Statsd</code> subsection must also be configured with the address of the StatsD daemon, the network type to use (<code class="language-plaintext highlighter-rouge">tcp</code> or <code class="language-plaintext highlighter-rouge">udp</code>), and how often to send the metrics. An optional <code class="language-plaintext highlighter-rouge">prefix</code> may be specified to help differentiate the source of the metrics.</p> <p>一个<code class="language-plaintext highlighter-rouge">Orderer</code>节点可以通过设置<code class="language-plaintext highlighter-rouge">orderer.yaml</code>中<code class="language-plaintext highlighter-rouge">Metrics</code>部分的<code class="language-plaintext highlighter-rouge">Provider</code>为<code class="language-plaintext highlighter-rouge">statsd</code>来将其配置成发送指标到StatsD。<code class="language-plaintext highlighter-rouge">statsd</code>的子模块也同样需要配置：StatsD进程的地址（ip+端口），网络类型（TCP 或 UDP），发送metrics的频率。一个可选的<code class="language-plaintext highlighter-rouge">prefix</code>或许可以被用作区分不同资源的指标。</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">Metrics</span><span class="pi">:</span>
    <span class="na">Provider</span><span class="pi">:</span> <span class="s">statsd</span>
    <span class="na">Statsd</span><span class="pi">:</span>
      <span class="na">Network</span><span class="pi">:</span> <span class="s">udp</span>
      <span class="na">Address</span><span class="pi">:</span> <span class="s">127.0.0.1:8125</span>
      <span class="na">WriteInterval</span><span class="pi">:</span> <span class="s">30s</span>
      <span class="na">Prefix</span><span class="pi">:</span> <span class="s">org-orderer</span>
</code></pre></div></div> <p>For a look at the different metrics that are generated, check out <a href="https://hyperledger-fabric.readthedocs.io/en/release-2.0/metrics_reference.html">Metrics Reference</a>.</p> <br> <nav class="pagination"> <a href="http://localhost:4000/Fabric-Health-Check/" class="pagination_pager" title="Fabric: Health check ">previous</a> <a href="http://localhost:4000/Fabric-Service-Discovery/" class="pagination_pager" title="Fabric:Service Discovery ">next</a> </nav> </div> </div> <!-- JS --> <script src="http://localhost:4000/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://localhost:4000/images/unsplash-image-4.jpg) center center no-repeat;"> <a href="https://blog.maplestory.work/classcheckin.html" target="_blank" rel="nofollow external"> <span> 点名小程序 </span> </a> </li> </ul> </div> </body> </html>
