<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>线程池参数 &#8211; Maple Story</title> <meta name="description" content="Stick to note down what I’v learnt"> <meta name="keywords" content="Java, Thread"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="halve.png"> <meta name="twitter:title" content="线程池参数"> <meta name="twitter:description" content="Stick to note down what I’v learnt"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="线程池参数"> <meta property="og:description" content="Stick to note down what I’v learnt"> <meta property="og:url" content="http://localhost:4000/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8F%82%E6%95%B0/"> <meta property="og:site_name" content="Maple Story"> <meta property="og:image" content="http://localhost:4000/images/halve.png"> <link rel="canonical" href="http://localhost:4000/%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%8F%82%E6%95%B0/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/unsplash-gallery-image-3.jpg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/unsplash-image-10.jpg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(http://localhost:4000/images/home.jpg) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="http://localhost:4000" class="logo"><img src="http://localhost:4000/images/halve.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">线程池参数 </h1> <ul class="tags"> <li><a href="http://localhost:4000/tags#Java">Java</a></li> <li><a href="http://localhost:4000/tags#Thread">Thread</a></li> </ul> <div class="section-line reverse"><a href="http://localhost:4000/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <a href="../posts.html" title="posts" class="posts-menu-icon"></a> <a title="projects" class="projects-menu-icon"> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">05 Apr 2020</div> <center><h2><b>线程池参数</b></h2></center> <p><br /></p> <blockquote> <p>参考:</p> <p><a href="https://www.cnblogs.com/owenma/p/8557074.html">Java线程池使用和常用参数</a></p> </blockquote> <h3 id="为什么要用线程池"><strong>为什么要用线程池</strong></h3> <p>当我们需要的并发线程数量很多时，且每个线程执行很短的时间就结束了，这样，我们频繁的创建线程、销毁线程就大大降低了工作效率（创建与销毁线程需要时间和资源）。</p> <p>java的线程池可以达到这样的效果，一个线程执行完任务后，继续执行下一个任务，不被销毁，这样线程的利用率就提高了。</p> <h3 id="6个参数"><strong>6个参数</strong></h3> <p>1、<strong>corePoolSize</strong>：核心线程数 核心线程会一直存活，即使没有任务需要执行 当线程数小于核心线程数时，即使有线程空闲，线程池也会优先创建新线程处理 设置allowCoreThreadTimeout=true（默认false）时，核心线程会超时关闭。</p> <p>2、<strong>queueCapacity</strong>：任务队列容量（阻塞队列） 当核心线程数达到最大时，新任务会放在队列中排队等待执行</p> <p>3、<strong>maxPoolSize</strong>：最大线程数 当线程数&lt;=corePoolSize，且任务队列已满时。线程池会创建新线程来处理任务 当线程数=maxPoolSize，且任务队列已满时，线程池会拒绝处理任务而抛出异常</p> <p>​ <strong>值得注意的是如果使用了无界的任务队列这个参数就没什么效果。</strong>例如<code class="language-plaintext highlighter-rouge">new LinkedBlockingQueue&lt;Runnable&gt;()</code></p> <blockquote> <p>BlockingQueue <Runnable> workQueue 这个缓冲队列有三种类型：</Runnable></p> <ul> <li> <p>直接提交SynchronousQueue</p> </li> <li> <p>无界队列LinkedBlockingQueue</p> </li> <li> <p>有界队列ArrayBlockingQueue</p> </li> </ul> </blockquote> <p>4、 <strong>keepAliveTime</strong>：线程空闲时间 当线程空闲时间达到keepAliveTime时，线程会退出，直到线程数量=corePoolSize <em>如果allowCoreThreadTimeout=true，则会直到线程数量=0</em> 一般在线程数量大于核心线程数量时才会起作用，如果一个线程空闲时间达到keepAliveTime时会被终止，直到线程数不超过keepAliveTime</p> <p>5、 <strong>allowCoreThreadTimeout</strong>：允许核心线程进行超时退出。当核心线程超时后也会退出</p> <p>6、 <strong>rejectedExecutionHandler</strong>：任务拒绝处理句柄。</p> <ul> <li>两种情况会拒绝处理任务: <ul> <li>当线程数已经达到maxPoolSize，切队列已满，会拒绝新任务</li> <li>用shutdown()后，会等待线程池里的任务执行完毕，再shutdown。如果在调用shutdown()和线程池真正shutdown之间提交任务，会拒绝新任务</li> </ul> </li> <li>线程池会调用rejectedExecutionHandler来处理这个任务。如果没有设置默认是AbortPolicy，会抛出异常</li> <li>ThreadPoolExecutor类有几个内部实现类来处理这类情况： <ul> <li>AbortPolicy 丢弃任务，抛运行时异常</li> <li>RunsPolicy 执行任务</li> <li>DiscardPolicy 忽视，什么都不会发生 dOldestPolicy 从队列中踢出最先进入队列（最后一个执行）的任务</li> <li>实现RejectedExecutionHandler接口，可自定义处理器</li> </ul> </li> </ul> <h3 id="threadpoolexecutor执行顺序"><strong>ThreadPoolExecutor执行顺序</strong></h3> <p>线程池按以下行为执行任务</p> <ol> <li>当线程数小于核心线程数时，创建线程。</li> <li>当线程数大于等于核心线程数，且任务队列未满时，将任务放入任务队列。</li> <li>当线程数大于等于核心线程数，且任务队列已满 <ul> <li>若线程数小于最大线程数，创建线程</li> <li>若线程数等于最大线程数，抛出异常，拒绝任务</li> </ul> </li> </ol> <h3 id="线程池状态">线程池状态</h3> <table> <thead> <tr> <th>状态</th> <th>解释</th> </tr> </thead> <tbody> <tr> <td>RUNNING</td> <td>运行态，可处理新任务并执行队列中的任务</td> </tr> <tr> <td>SHUTDOW</td> <td>关闭态，不接受新任务，但处理队列中的任务</td> </tr> <tr> <td>STOP</td> <td>停止态，不接受新任务，不处理队列中任务，且打断运行中任务</td> </tr> <tr> <td>TIDYING</td> <td>整理态，所有任务已经结束，workerCount = 0 ，将执行terminated()方法</td> </tr> <tr> <td>TERMINATED</td> <td>结束态，terminated() 方法已完成</td> </tr> </tbody> </table> <p>与线程六个状态不同概念： <a href="[https://blog.maplestory.work/Java%E7%BA%BF%E7%A8%8B%E4%B8%8D%E8%83%BD%E9%87%8D%E5%A4%8DStart/](https://blog.maplestory.work/Java线程不能重复Start/)">线程状态</a></p> <blockquote> <p>参考：徐志毅<a href="https://www.jianshu.com/p/18065a78178b">线程池之ThreadPoolExecutor状态控制</a></p> </blockquote> <br> <nav class="pagination"> <a href="http://localhost:4000/java%E4%B8%89%E7%A7%8D%E5%88%9B%E5%BB%BA%E7%BA%BF%E7%A8%8B%E7%9A%84%E6%96%B9%E6%B3%95/" class="pagination_pager" title="java三种创建线程的方法 ">previous</a> <a href="http://localhost:4000/%E4%B9%90%E8%A7%82%E9%94%81%E5%92%8C%E6%82%B2%E8%A7%82%E9%94%81/" class="pagination_pager" title="乐观锁 ">next</a> </nav> </div> </div> <!-- JS --> <script src="http://localhost:4000/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://localhost:4000/images/benjamin-deyoung-unsplash.jpg) center center no-repeat;"> <a href="https://github.com/Maple-Chan" target="_blank" rel="nofollow external"> <span> GitHub Home </span> </a> </li> </ul> </div> </body> </html>
