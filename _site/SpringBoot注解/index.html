<!DOCTYPE html> <html> <head> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no"> <title>Spring Boot 注解 &#8211; Maple Story</title> <meta name="description" content="Stick to note down what I’v learnt"> <meta name="keywords" content="Spring Boot"> <!-- Twitter Cards --> <meta name="twitter:card" content="summary"> <meta name="twitter:image" content="halve.png"> <meta name="twitter:title" content="Spring Boot 注解"> <meta name="twitter:description" content="Stick to note down what I’v learnt"> <!-- Open Graph --> <meta property="og:locale" content="en_US"> <meta property="og:type" content="article"> <meta property="og:title" content="Spring Boot 注解"> <meta property="og:description" content="Stick to note down what I’v learnt"> <meta property="og:url" content="http://localhost:4000/SpringBoot%E6%B3%A8%E8%A7%A3/"> <meta property="og:site_name" content="Maple Story"> <meta property="og:image" content="http://localhost:4000/images/halve.png"> <link rel="canonical" href="http://localhost:4000/SpringBoot%E6%B3%A8%E8%A7%A3/"> <!-- Handheld --> <meta name="HandheldFriendly" content="True"> <meta name="MobileOptimized" content="320"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Feed --> <link type="application/atom+xml" rel="alternate" href="http://localhost:4000/feed.xml" title="" /> <!-- Favicons --> <link rel="shortcut icon" type="image/png" href="http://localhost:4000/favicon.png" /> <link rel="shortcut icon" href="http://localhost:4000/favicon.ico" /> <!-- CSS --> <link rel="stylesheet" type="text/css" href="http://localhost:4000/assets/css/main.css"> <!-- Left Block Image for Posts --> <style type="text/css"> #posts.inner-post-page .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/unsplash-gallery-image-3.jpg) no-repeat;background-size: cover;} </style> <!-- Left Block Images for Home and Pages --> <style type="text/css"> #posts .block-left {background: linear-gradient(rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url(http://localhost:4000/images/unsplash-image-10.jpg) no-repeat;background-size: cover, cover;} .block-left {background: linear-gradient(rgba(44,45,51,0.9), rgba(44,45,51,0.9)), url(http://localhost:4000/images/home.jpg) no-repeat;background-size: cover;} </style> </head> <body id="posts" class="inner-post-page"> <div class="block-left"> <div class="content"> <a href="http://localhost:4000" class="logo"><img src="http://localhost:4000/images/halve.png"></a> <div class="post-title-section"> <div class="section-line">Posts <em>/</em></div> <h1 class="section-title">Spring Boot 注解 </h1> <ul class="tags"> <li><a href="http://localhost:4000/tags#Spring Boot">Spring Boot</a></li> </ul> <div class="section-line reverse"><a href="http://localhost:4000/posts">Back to posts</a> <em>/</em></div> </div> </div> </div> <div class="block-right"> <a href="../posts.html" title="posts" class="posts-menu-icon"></a> <a title="projects" class="projects-menu-icon"> <span></span> </a> <div class="inner-post content"> <div class="date-highlight">13 May 2020</div> <center><h2><b>Spring Boot 注解</b></h2></center> <p><br /></p> <h2 id="注解">注解</h2> <h3 id="transactional">@Transactional</h3> <p>异常分类：</p> <p><img src="https://blog.maplestory.work/images/post_image/Spring 记录.assets/20171027131229769.jpg" alt="20171027131229769" /></p> <p>Exception下分可检查异常（check exceptions）和不可检查异常(unchecked exceptions)。</p> <ul> <li><strong>可检查异常</strong>：Exception下除了RuntimeException外的异常</li> <li><strong>不可检查异常</strong>：RuntimeException及其子类和错误（Error）</li> <li>不对运行时异常进行处理，要么线程终止，要么主程序终止。如果不想终止则必须捕获异常。</li> <li>非运行时异常，除运行时异常以外的Exception包括用户自定义的异常，Java编译器强制要求对其进行catch / throws并处理，否则无法通过。</li> </ul> <p>@Transaction 默认只有在抛出不可检查异常时才标识事务回滚。</p> <ol> <li> <p>让checked例外也回滚：在整个方法前加上 @Transactional(rollbackFor=Exception.class)</p> </li> <li> <p>让unchecked例外不回滚： @Transactional(notRollbackFor=RunTimeException.class)</p> </li> <li> <p>不需要事务管理的(只查询的)方法：@Transactional(propagation=Propagation.NOT_SUPPORTED)</p> </li> </ol> <p>Note:</p> <ul> <li>如果异常被try｛｝catch｛｝了，事务就不回滚了，如果想让事务回滚必须再往外抛try｛｝catch｛throw Exception｝。</li> <li>Spring团队的建议是你在具体的类（或类的方法）上使用 @Transactional 注解，而<strong>不要使用在类所要实现的任何接口上</strong>。你当然可以在接口上使用 @Transactional 注解，但是这将只能当你设置了基于接口的代理时它才生效。因为注解是不能继承的，这就意味着如果你正在使用基于类的代理时，那么事务的设置将不能被基于类的代理所识别，而且对象也将不会被事务代理所包装（将被确认为严重的）。因此，请接受Spring团队的建议并且在具体的类上使用 @Transactional 注解。</li> <li>@Transactional 注解标识的方法，<strong>处理过程尽量的简单</strong>。尤其是带锁的事务方法，能不放在事务里面的最好不要放在事务里面。可以将常规的数据库查询操作放在事务前面进行，而事务内进行增、删、改、加锁查询等操作。</li> </ul> <h3 id="autowired">@Autowired</h3> <p>@Autowired注解标注类成员变量、方法、构造函数这些位置，可以实现自动装配的工作。</p> <p>@Autowired使用规则：</p> <ol> <li> <p>@Autowired默认是按照类型进行匹配的（byType），默认情况下，它要求依赖对象必须存在，否则会报错，当然我们也可以设置@Autowired（required=false）来设置。</p> </li> <li> <p>@Autowired的查找过程如下：</p> <blockquote> <p>@Autowired注解在容器中查找对应类型的bean</p> <ul> <li>如果结果刚好为一个，则将该bean装配给@Autowired指定的变量</li> <li>如果一个也没有，并且required=true的情况下，则报错</li> <li>如果为多个，则也会报错，因为Spring不知道该依赖哪一个具体的bean</li> </ul> </blockquote> </li> </ol> <p>@Autowired按byType自动注入，而@Resource默认按 byName自动注入罢了。</p> <p>两个同一个类型的注解，Autowired将无法区分</p> <h3 id="service">@Service</h3> <p>如果 Web 应用程序采用了经典的三层分层结构的话，最好在持久层、业务层和控制层分别采用 @Repository、@Service 和 @Controller 对分层中的类进行注释，而用 @Component 对那些比较中立的类进行注释。</p> <p>Spring2.5为我们引入了组件自动扫描机制，他可以在类路径底下寻找标注了@Component, @Service, @Controller, @Repository 注解的类，并把这些类纳入进spring容器中管理。它的作用和在xml文件中使用bean节点配置组件时一样的。</p> <p>@Service、@Repository、@Controller、@Component这四个作用差不多，主要适用于区别该类在Web应用中所属的层次。例如MVC。</p> <h3 id="requestmapping">@RequestMapping</h3> <blockquote> <p>方法不为public也能访问</p> </blockquote> <ol> <li>这个注解会将HTTP请求映射到MVC和REST控制器的处理方法上。（就是配置Web请求映射）</li> <li>这个注解可以放在类上也可以放在方法上。放在类级别上，会将一个请求或者请求模式映射到一个控制器上。放在方法上，可以进一步制定处理方法的映射关系。</li> </ol> <p><strong>@RequestMapping可以处理多个URI，将多个请求映射到一个方法上。</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="nd">@RestController</span><span class="err">  </span>
   <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/home"</span><span class="o">)</span><span class="err">  </span>
   <span class="kd">public</span><span class="err"> </span><span class="kd">class</span><span class="err"> </span><span class="nc">IndexController</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
   <span class="err">  </span>
   <span class="err">    </span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
   <span class="err">        </span><span class="s">""</span><span class="o">,</span><span class="err">  </span>
   <span class="err">        </span><span class="s">"/page"</span><span class="o">,</span><span class="err">  </span>
   <span class="err">        </span><span class="s">"page*"</span><span class="o">,</span><span class="err">  </span>
   <span class="err">        </span><span class="s">"view/*,**/msg"</span><span class="err">  </span>
   <span class="err">    </span><span class="o">})</span><span class="err">  </span>
   <span class="err">    </span><span class="nc">String</span><span class="err"> </span><span class="n">indexMultipleMapping</span><span class="o">()</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
   <span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"Hello from index multiple mapping."</span><span class="o">;</span><span class="err">  </span>
   <span class="err">    </span><span class="o">}</span><span class="err">  </span>
   <span class="o">}</span><span class="err">  </span>
</code></pre></div></div> <p><strong>@RequestMapping处理HTTP的各种方法。</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span><span class="err">  </span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/home"</span><span class="o">)</span><span class="err">  </span><span class="c1">//所有方法GET/POST/...等方法都会通过/home请求进来。</span>
<span class="kd">public</span><span class="err"> </span><span class="kd">class</span><span class="err"> </span><span class="nc">IndexController</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">    </span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span><span class="err">  </span><span class="c1">//处理GET方法</span>
<span class="err">    </span><span class="nc">String</span><span class="err"> </span><span class="n">get</span><span class="o">()</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"Hello from get"</span><span class="o">;</span><span class="err">  </span>
<span class="err">    </span><span class="o">}</span><span class="err">  </span>
<span class="err">    </span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="nc">RequestMethod</span><span class="o">.</span><span class="na">DELETE</span><span class="o">)</span><span class="err">  </span>
<span class="err">    </span><span class="nc">String</span><span class="err"> </span><span class="n">delete</span><span class="o">()</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"Hello from delete"</span><span class="o">;</span><span class="err">  </span>
<span class="err">    </span><span class="o">}</span><span class="err">  </span>
<span class="err">    </span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="nc">RequestMethod</span><span class="o">.</span><span class="na">POST</span><span class="o">)</span><span class="err">  </span>
<span class="err">    </span><span class="nc">String</span><span class="err"> </span><span class="n">post</span><span class="o">()</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"Hello from post"</span><span class="o">;</span><span class="err">  </span>
<span class="err">    </span><span class="o">}</span><span class="err">  </span>
<span class="err">    </span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="nc">RequestMethod</span><span class="o">.</span><span class="na">PUT</span><span class="o">)</span><span class="err">  </span>
<span class="err">    </span><span class="nc">String</span><span class="err"> </span><span class="n">put</span><span class="o">()</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"Hello from put"</span><span class="o">;</span><span class="err">  </span>
<span class="err">    </span><span class="o">}</span><span class="err">  </span>
<span class="err">    </span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">method</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="nc">RequestMethod</span><span class="o">.</span><span class="na">PATCH</span><span class="o">)</span><span class="err">  </span>
<span class="err">    </span><span class="nc">String</span><span class="err"> </span><span class="n">patch</span><span class="o">()</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"Hello from patch"</span><span class="o">;</span><span class="err">  </span>
<span class="err">    </span><span class="o">}</span><span class="err">  </span>
<span class="o">}</span><span class="err">  </span>
</code></pre></div></div> <p><strong>用@RequestMapping来处理生产和消费对象</strong></p> <p>使用该注解的produces\consumes这两个元素来缩小请求映射类型的范围。为了能用请求的媒体类型来产生/消费对象，可以结合@ResponseBody注解来完成</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/home"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IndexController</span><span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/prod"</span><span class="o">,</span><span class="n">produces</span> <span class="o">={</span>
        <span class="s">"application/JSON"</span>
    <span class="o">})</span>
    <span class="nd">@ResponseBody</span>
    <span class="nc">String</span> <span class="nf">getProduces</span><span class="o">(){</span>
        <span class="k">return</span> <span class="s">"Produces attribute"</span><span class="o">;</span>
    <span class="o">}</span>
    
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="s">"/cons"</span><span class="o">,</span><span class="err"> </span><span class="n">consumes</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="s">"application/JSON"</span><span class="o">,</span><span class="err">  </span>
<span class="err">        </span><span class="s">"application/XML"</span><span class="err">  </span>
<span class="err">    </span><span class="o">})</span><span class="err">  </span>
    <span class="nd">@ResponseBody</span>
<span class="err">    </span><span class="nc">String</span><span class="err"> </span><span class="n">getConsumes</span><span class="o">()</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"Consumes attribute"</span><span class="o">;</span><span class="err">  </span>
<span class="err">    </span><span class="o">}</span>
<span class="o">}</span>
<span class="c1">//在这段代码中，getProduces()处理方法会产生一个JSON响应，getConsumes()处理方法可以同时处理请求中的JSON和XML内容。</span>
</code></pre></div></div> <p><strong>使用 @RequestMapping 来处理消息头</strong></p> <p>@RequestMapping注解提供一个header元素来根据请求中的消息头内容缩小请求映射的范围。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span><span class="err">  </span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/home"</span><span class="o">)</span><span class="err">  </span>
<span class="kd">public</span><span class="err"> </span><span class="kd">class</span><span class="err"> </span><span class="nc">IndexController</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">    </span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="s">"/head"</span><span class="o">,</span><span class="err"> </span><span class="n">headers</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="s">"content-type=text/plain"</span><span class="o">,</span>
        <span class="s">"content-type=text/html"</span>  
<span class="err">    </span><span class="o">})</span><span class="err">  </span>
<span class="err">    </span><span class="nc">String</span><span class="err"> </span><span class="n">post</span><span class="o">()</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"Mapping applied along with headers"</span><span class="o">;</span><span class="err">  </span>
<span class="err">    </span><span class="o">}</span><span class="err">  </span>
<span class="o">}</span><span class="err">  </span>
<span class="c1">//上述代码中，映射的范围缩了，post()方法只处理/home/head并且content-typeheader被指定为text/plain和text/html这个两个请求.</span>
</code></pre></div></div> <p><strong>使用@RequestMapping来处理请求参数,进一步缩小映射范围.</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span><span class="err">  </span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/home"</span><span class="o">)</span><span class="err">  </span>
<span class="kd">public</span><span class="err"> </span><span class="kd">class</span><span class="err"> </span><span class="nc">IndexController</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">    </span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="s">"/fetch"</span><span class="o">,</span><span class="err"> </span><span class="n">params</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="s">"personId=10"</span><span class="err">  </span>
<span class="err">    </span><span class="o">})</span><span class="err">  </span>
<span class="err">    </span><span class="nc">String</span><span class="err"> </span><span class="n">getParams</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"personId"</span><span class="o">)</span><span class="err"> </span><span class="nc">String</span><span class="err"> </span><span class="n">id</span><span class="o">)</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"Fetched parameter using params attribute = "</span><span class="err"> </span><span class="o">+</span><span class="err"> </span><span class="n">id</span> <span class="o">+</span> <span class="s">"in function: getParams()"</span><span class="o">;</span><span class="err">  </span>
<span class="err">    </span><span class="o">}</span><span class="err">  </span>
    
<span class="err">    </span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="s">"/fetch"</span><span class="o">,</span><span class="err"> </span><span class="n">params</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="s">"personId=20"</span><span class="err">  </span>
<span class="err">    </span><span class="o">})</span><span class="err">  </span>
<span class="err">    </span><span class="nc">String</span><span class="err"> </span><span class="n">getParamsDifferent</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"personId"</span><span class="o">)</span><span class="err"> </span><span class="nc">String</span><span class="err"> </span><span class="n">id</span><span class="o">)</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"Fetched parameter using params attribute = "</span><span class="err"> </span><span class="o">+</span><span class="err"> </span><span class="n">id</span> <span class="o">+</span> <span class="s">"in function: getParamsDifferent()"</span><span class="o">;</span><span class="err">  </span>
<span class="err">    </span><span class="o">}</span><span class="err">  </span>
<span class="o">}</span><span class="err">  </span>
<span class="c1">// 上面两个方法,根据personId的不同进入了不同的函数.</span>
</code></pre></div></div> <p><strong>使用 @RequestMapping 处理动态 URI</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/home"</span><span class="o">)</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">IndexController</span><span class="o">{</span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="o">=</span><span class="s">"/fectc/{id}"</span><span class="o">,</span> <span class="n">method</span> <span class="o">=</span> <span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span>
    <span class="nc">String</span> <span class="nf">getDynamicUriValue</span><span class="o">(</span><span class="nd">@PathVariable</span> <span class="nc">String</span> <span class="n">id</span><span class="o">){</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ID is:"</span><span class="o">+</span><span class="n">id</span><span class="o">);</span>
        <span class="k">return</span> <span class="s">"Dynamic URI parameter fetched"</span><span class="o">;</span>  
    <span class="o">}</span>
    <span class="c1">//在这段代码中，方法 getDynamicUriValue() 会在发起到 localhost:8080/home/fetch/10 的请求时执行。这里 getDynamicUriValue() 方法 id 参数也会动态地被填充为 10 这个值。 </span>
    <span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="s">"/fetch/{id:[a-z]+}/{name}"</span><span class="o">,</span><span class="err"> </span><span class="n">method</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="nc">RequestMethod</span><span class="o">.</span><span class="na">GET</span><span class="o">)</span><span class="err">  </span>
<span class="err">    </span><span class="nc">String</span><span class="err"> </span><span class="n">getDynamicUriValueRegex</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"name"</span><span class="o">)</span><span class="err"> </span><span class="nc">String</span><span class="err"> </span><span class="n">name</span><span class="o">)</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"Name is "</span><span class="err"> </span><span class="o">+</span><span class="err"> </span><span class="n">name</span><span class="o">);</span><span class="err">  </span>
<span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"Dynamic URI parameter fetched using regex"</span><span class="o">;</span><span class="err">  </span>
<span class="err">    </span><span class="o">}</span><span class="err">  </span>
	<span class="c1">//方法 getDynamicUriValueRegex() 会在发起到 localhost:8080/home/fetch/chan/maple 的请求时执行。不过，如果发起的请求是 /home/fetch/10/maple 的话，会抛出异常，因为这个URI并不能匹配正则表达式。 </span>

<span class="o">}</span>
    
</code></pre></div></div> <p><strong>RequestMapping默认的处理方法</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span><span class="err">  </span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/home"</span><span class="o">)</span><span class="err">  </span>
<span class="kd">public</span><span class="err"> </span><span class="kd">class</span><span class="err"> </span><span class="nc">IndexController</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">    </span><span class="nd">@RequestMapping</span><span class="o">()</span><span class="err">  </span><span class="c1">// @RequestMapping("/") 如果写了"/" ，则在访问时必须/home/</span>
    				 <span class="c1">// @RequestMapping()的情况下,可以直接用/home访问到，如果没有写上面的映						射，则在第二种情况使用/home/也能访问到该函数</span>
<span class="err">    </span><span class="nc">String</span><span class="err">  </span>
<span class="err">    </span><span class="n">defaultMapping</span><span class="err"> </span><span class="o">()</span><span class="err"> </span><span class="o">{</span><span class="err">  </span><span class="c1">//default是java关键字,不能作为方法名.</span>
<span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"This is a default method for the class"</span><span class="o">;</span><span class="err">  </span>
<span class="err">    </span><span class="o">}</span><span class="err">  </span>
    <span class="c1">//参考 ：这里面用了关键字default</span>
    <span class="c1">//https://blog.csdn.net/originations/article/details/89492884</span>
<span class="o">}</span><span class="err">  </span>
</code></pre></div></div> <p><strong>RequestMapping快捷方式</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="nd">@GetMapping</span>
   <span class="nd">@PostMapping</span>
   <span class="nd">@PutMapping</span>
   <span class="nd">@DeleteMapping</span>
   <span class="nd">@PatchMapping</span>
   <span class="c1">//RequestMapping的基础上进行了封装，</span>
   <span class="c1">//尽管每个变体都可以使用带有方法属性的 @RequestMapping 注解来互换实现, 但组合变体仍然是一种最佳的实践 — 这主要是因为组合注解减少了在应用程序上要配置的元数据，并且代码也更易读。 </span>
</code></pre></div></div> <h3 id="requestparam">@RequestParam</h3> <p>@RequestParam注解配合使用，将请求的参数同处理方法的参数绑定在一起。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="nd">@RestController</span><span class="err">  </span>
   <span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/home"</span><span class="o">)</span><span class="err">  </span>
   <span class="kd">public</span><span class="err"> </span><span class="kd">class</span><span class="err"> </span><span class="nc">IndexController</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
   <span class="err">  </span>
   <span class="err">    </span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="s">"/id"</span><span class="o">)</span><span class="err">  </span>
   <span class="err">    </span><span class="nc">String</span><span class="err"> </span><span class="n">getIdByValue</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span><span class="err"> </span><span class="nc">String</span><span class="err"> </span><span class="n">personId</span><span class="o">)</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
   <span class="err">        </span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ID is "</span><span class="err"> </span><span class="o">+</span><span class="err"> </span><span class="n">personId</span><span class="o">);</span><span class="err">  </span>
   <span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"Get ID from query string of URL with value element"</span><span class="o">;</span><span class="err">  </span>
   <span class="err">    </span><span class="o">}</span><span class="err">  </span>
   <span class="err">    </span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="s">"/personId"</span><span class="o">)</span><span class="err">  </span>
   <span class="err">    </span><span class="nc">String</span><span class="err"> </span><span class="n">getId</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="err"> </span><span class="nc">String</span><span class="err"> </span><span class="n">personId</span><span class="o">)</span><span class="err"> </span><span class="o">{</span><span class="err">  </span><span class="c1">//如果传的参数和处理方法的参数名称一样的话，注解的value就可以省略。</span>
   <span class="err">        </span><span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"ID is "</span><span class="err"> </span><span class="o">+</span><span class="err"> </span><span class="n">personId</span><span class="o">);</span><span class="err">  </span>
   <span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"Get ID from query string of URL without value element"</span><span class="o">;</span><span class="err">  </span>
   <span class="err">    </span><span class="o">}</span><span class="err">  </span>
   <span class="o">}</span><span class="err">  </span>
</code></pre></div></div> <p>@RequestParam 注解的 required 这个参数定义了参数值是否是必须要传的。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span><span class="err">  </span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/home"</span><span class="o">)</span><span class="err">  </span>
<span class="kd">public</span><span class="err"> </span><span class="kd">class</span><span class="err"> </span><span class="nc">IndexController</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">    </span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="s">"/name"</span><span class="o">)</span><span class="err">  </span>
<span class="err">    </span><span class="nc">String</span><span class="err"> </span><span class="n">getName</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="s">"person"</span><span class="o">,</span><span class="err"> </span><span class="n">required</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="kc">false</span><span class="o">)</span><span class="err"> </span><span class="nc">String</span><span class="err"> </span><span class="n">personName</span><span class="o">)</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"Required element of request param"</span><span class="o">;</span><span class="err">  </span>
<span class="err">    </span><span class="o">}</span><span class="err">  </span>
<span class="o">}</span><span class="err">  </span>
<span class="c1">// 在这段代码中，因为 required 被指定为 false，所以 getName() 处理方法对于如下两个 URL 都会进行处理： </span>
<span class="c1">// /home/name?person=xyz</span>
<span class="c1">// /home/name</span>
</code></pre></div></div> <p>@RequestParam注解的defaultValue参数就是用来给取值为空的请求参数提供一个默认值</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RestController</span><span class="err">  </span>
<span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/home"</span><span class="o">)</span><span class="err">  </span>
<span class="kd">public</span><span class="err"> </span><span class="kd">class</span><span class="err"> </span><span class="nc">IndexController</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">    </span><span class="nd">@RequestMapping</span><span class="o">(</span><span class="n">value</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="s">"/name"</span><span class="o">)</span><span class="err">  </span>
<span class="err">    </span><span class="nc">String</span><span class="err"> </span><span class="n">getName</span><span class="o">(</span><span class="nd">@RequestParam</span><span class="o">(</span><span class="n">value</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="s">"person"</span><span class="o">,</span><span class="err"> </span><span class="n">defaultValue</span><span class="err"> </span><span class="o">=</span><span class="err"> </span><span class="s">"John"</span><span class="o">)</span><span class="err"> </span><span class="nc">String</span><span class="err"> </span><span class="n">personName</span><span class="o">)</span><span class="err"> </span><span class="o">{</span><span class="err">  </span>
<span class="err">        </span><span class="k">return</span><span class="err"> </span><span class="s">"Required element of request param."</span><span class="o">+</span><span class="s">"personName:"</span><span class="o">+</span><span class="n">personName</span><span class="o">;</span><span class="err">  </span>
<span class="err">    </span><span class="o">}</span><span class="err">  </span>
<span class="o">}</span><span class="err">  </span>
</code></pre></div></div> <h3 id="responsebody">@ResponseBody</h3> <p>其作用是，将java对象转为json格式的数据。</p> <p>@responseBody注解的作用是将controller的方法返回的对象通过适当的转换器转换为指定的格式之后，写入到response对象的body区，通常用来返回JSON数据或者是XML数据。</p> <h3 id="pathvariable">@PathVariable</h3> <p>@PathVariable只支持一个属性value，类型是String，代表绑定的属性名。默认绑定同名参数。用来便捷地提取URL中的动态参数。</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@RequestMapping</span><span class="o">(</span><span class="s">"/viewUser/{id}/{name}"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="nf">viewUser</span><span class="o">(</span><span class="nd">@PathVariable</span><span class="o">(</span><span class="s">"id"</span><span class="o">)</span> <span class="nc">Integer</span> <span class="n">idInt</span><span class="o">,</span> <span class="nd">@PathVariable</span> <span class="nc">Integer</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"@PathVariable中 请求参数 id = "</span> <span class="o">+</span> <span class="n">idInt</span><span class="o">);</span>
        <span class="nc">Map</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">,</span> <span class="nc">Object</span><span class="o">&gt;</span> <span class="n">user</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">HashMap</span><span class="o">&lt;&gt;();</span>
        <span class="n">user</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"id"</span><span class="o">,</span> <span class="n">idInt</span><span class="o">);</span>
        <span class="n">user</span><span class="o">.</span><span class="na">put</span><span class="o">(</span><span class="s">"name"</span><span class="o">,</span> <span class="n">name</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">user</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div></div> <p>与RequestParam不同，这个将请求的参数与函数的参数绑定在一起。</p> <h3 id="requestbody">@RequestBody</h3> <p>在我们的请求到达controller之前，也就是到达DispacherServlet中心处理器的时候，如果有@RequestBody会对参数进行一次解析，把json字符串解析出对象，也就是说只解析一次，两个@requestBody只能弄一个，对象的json是以“{”开头，list的json是以“[”开头 ，所以基本都是json解析出错</p> <p><img src="https://blog.maplestory.work/images/post_image/Spring 记录.assets/1591168626309.png" alt="1591168626309" /></p> <h3 id="查看两个body的源码">查看两个Body的源码</h3> <h3 id="bean">@Bean</h3> <blockquote> <p><a href="https://www.cnblogs.com/cxuanBlog/p/11179439.html">@Bean 注解全解析</a></p> <p><a href="https://www.cnblogs.com/east7/p/13199749.html">Spring注解之@Bean 用法介绍</a></p> </blockquote> <p>注解 @Bean是一个方法级别的注解，主要<strong>用在@Configuration注解的类</strong>里，也可以用<strong>在@Component注解的类</strong>里，默认添加的bean的id为方法名。</p> <h4 id="bean的依赖">@Bean的依赖</h4> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Configuration</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">AppConfig</span> <span class="o">{</span>
    <span class="nd">@Bean</span>
    <span class="kd">public</span> <span class="nc">TransferService</span> <span class="nf">transferService</span><span class="o">(</span><span class="nc">AccountRepository</span> <span class="n">accountRepository</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">TransferServiceImpl</span><span class="o">(</span><span class="n">accountRepository</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div> <h4 id="自定义bean别名">自定义Bean别名</h4> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="nd">@Bean</span><span class="o">(</span><span class="s">"myBeanObj"</span><span class="o">)</span>
    <span class="kd">public</span> <span class="nc">BeanTest</span> <span class="nf">getBeanObj</span><span class="o">()</span> <span class="o">{</span>
        <span class="nc">BeanTest</span> <span class="n">bean</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">BeanTest</span><span class="o">();</span>
        <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">"调用方法："</span> <span class="o">+</span> <span class="n">bean</span><span class="o">);</span>
        <span class="k">return</span> <span class="n">bean</span><span class="o">;</span>
    <span class="o">}</span>
</code></pre></div></div> <p>通过下面的方法可以定义多个别名：</p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Bean</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="o">{</span> <span class="s">"myBeanObj"</span><span class="o">,</span> <span class="s">"myBeanObj1"</span><span class="o">,</span> <span class="s">"beanObj"</span> <span class="o">})</span>
</code></pre></div></div> <p><strong>实践</strong></p> <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// =============================</span>
<span class="nd">@RunWith</span><span class="o">(</span><span class="nc">SpringJUnit4ClassRunner</span><span class="o">.</span><span class="na">class</span><span class="o">)</span><span class="c1">//加载程序上下文</span>
<span class="nd">@ContextConfiguration</span><span class="o">(</span>
        <span class="n">classes</span> <span class="o">=</span> <span class="nc">TestBean</span><span class="o">.</span><span class="na">class</span>
<span class="o">)</span><span class="c1">//测试类</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestForBean</span> <span class="o">{</span>
    <span class="nd">@Autowired</span>
    <span class="nc">BeanClass</span> <span class="n">beanClass</span><span class="o">;</span><span class="c1">//自动装载对象</span>
    <span class="nd">@Test</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">loadBeanClass</span><span class="o">(){</span>
        <span class="n">beanClass</span><span class="o">.</span><span class="na">getInfo</span><span class="o">();</span><span class="c1">//调用Bean中的方法</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">// ==========================</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">BeanClass</span> <span class="o">{</span>
    <span class="c1">//Bean对象</span>
    <span class="nc">Logger</span> <span class="n">logger</span> <span class="o">=</span> <span class="nc">LoggerFactory</span><span class="o">.</span><span class="na">getLogger</span><span class="o">(</span><span class="nc">BeanClass</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="kd">public</span> <span class="nf">BeanClass</span><span class="o">(){</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"====="</span><span class="o">);</span>
    <span class="o">}</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">getInfo</span><span class="o">(){</span>
        <span class="n">logger</span><span class="o">.</span><span class="na">info</span><span class="o">(</span><span class="s">"getInfo"</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
<span class="c1">//  ========================</span>
<span class="nd">@Service</span>
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">TestBean</span> <span class="o">{</span>
    <span class="nd">@Bean</span>  <span class="c1">// Bean注解，返回Bean对象。</span>
    <span class="kd">public</span> <span class="nc">BeanClass</span> <span class="nf">getBeanClass</span><span class="o">(){</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">BeanClass</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div> <br> <nav class="pagination"> <a href="http://localhost:4000/FabricV2.0%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/" class="pagination_pager" title="Chaincode lifecycle_v2.0官方原文+翻译 ">previous</a> <a href="http://localhost:4000/FabricV2.0%E6%B5%8B%E8%AF%95%E6%A0%B7%E4%BE%8Btest-network/" class="pagination_pager" title="FabricV2.0测试样例test-network ">next</a> </nav> </div> </div> <!-- JS --> <script src="http://localhost:4000/assets/js/main.min.js"></script> <div class="overlay"> <ul class="projects-menu"> <li style="background:url(http://localhost:4000/images/benjamin-deyoung-unsplash.jpg) center center no-repeat;"> <a href="https://github.com/Maple-Chan" target="_blank" rel="nofollow external"> <span> GitHub Home </span> </a> </li> <li style="background:url(http://localhost:4000/images/unsplash-image-4.jpg) center center no-repeat;"> <a href="https://blog.maplestory.work/page/classcheckin.html" target="_blank" rel="nofollow external"> <span> 点名小程序 </span> </a> </li> </ul> </div> </body> </html>
